#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <time.h>

// Function to simulate transmission delay
void simulateTransmissionDelay() {
    // Generate random delay between 1 to 3 seconds
    int delay = (rand() % 3) + 1;
    sleep(delay);
}

// Sender function
void sender(int framesToSend) {
    int frame = 0;
    srand(time(0)); // Initialize random seed based on current time

    while (frame < framesToSend) {
        // Simulate transmission delay
        simulateTransmissionDelay();

        printf("\nSending Frame %d ...", frame);

        // Simulate acknowledgment reception delay
        simulateTransmissionDelay();

        // Simulate acknowledgment lost scenario (50% chance)
        if (rand() % 2 == 0) {
            printf("\nAcknowledgment for Frame %d not received (Timeout). Resending...", frame);
            continue; // Resend the same frame
        }

        printf("\nAcknowledgment received for Frame %d.", frame);
        frame++; // Move to the next frame
    }
}

// Receiver function
void receiver(int framesToReceive) {
    int expectedFrame = 0;
    srand(time(0)); // Initialize random seed based on current time

    while (expectedFrame < framesToReceive) {
        // Simulate transmission delay
        simulateTransmissionDelay();

        printf("\nWaiting for Frame %d ...", expectedFrame);

        // Simulate data reception delay
        simulateTransmissionDelay();

        // Simulate frame lost scenario (50% chance)
        if (rand() % 2 == 0) {
            printf("\nFrame %d not received (Timeout). Requesting retransmission...", expectedFrame);
            continue; // Request retransmission of the same frame
        }

        printf("\nFrame %d received successfully.", expectedFrame);

        // Simulate acknowledgment transmission delay
        simulateTransmissionDelay();

        printf("\nSending Acknowledgment for Frame %d ...", expectedFrame);

        expectedFrame++; // Move to the next expected frame
    }
}

// Main function
int main() {
    int framesToSend, framesToReceive;

    printf("Enter the number of frames to send/receive: ");
    scanf("%d", &framesToSend);
    framesToReceive = framesToSend;

    printf("\n\nSender side:\n");
    sender(framesToSend);

    printf("\n\nReceiver side:\n");
    receiver(framesToReceive);

    printf("\n\nCommunication completed successfully.\n");

    return 0;
}
